<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/common.css" />

    <link rel="stylesheet" type="text/css" href="css/main.css">
    <link rel="stylesheet" type="text/css" href="css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="css/define.css">

    <link rel="stylesheet" href="./css/colpick.css" type="text/css" />

    <link href="css/my.css" rel="stylesheet"/>

    <title>ccpool</title>

</head>
<body class="sidebar-mini fixed  pace-done">
<div class="pace  pace-inactive">
    <div class="pace-progress" data-progress-text="100%" data-progress="99"
         style="transform: translate3d(100%, 0px, 0px);">
        <div class="pace-progress-inner"></div>
    </div>
    <div class="pace-activity"></div>
</div>
<div class="wrapper">
    <!-- Navbar-->
    <header class="main-header hidden-print"><a class="logo" href="/html/index.html" style="margin-top:0px;font-size:40px;text-align:center;">ccpool</a>
        <nav class="navbar navbar-static-top">
            <a class="sidebar-toggle" href="/html/index.html" data-toggle="offcanvas"></a>
            <!-- Navbar Right Menu-->
            <div class="navbar-custom-menu">
                <ul class="top-nav">
                    <!--Notification Menu-->
                    <li class="dropdown notification-menu">
                        <a class="dropdown-toggle" href="/html/index.html" data-toggle="dropdown"
                           aria-expanded="false">
                            <i class="fa fa-bell-o fa-lg"></i>
                        </a>
                        <ul class="dropdown-menu">
                            <li class="not-head">你有4个消息待查看</li>
                            <li><a class="media" href="javascript:;"><span class="media-left media-icon"><span
                                    class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x text-primary"></i><i
                                    class="fa fa-envelope fa-stack-1x fa-inverse"></i></span></span>
                                <div class="media-body"><span class="block">有尚未审批的工单待处理</span><span
                                        class="text-muted block">2分钟前</span></div>
                            </a></li>
                            <li><a class="media" href="javascript:;"><span class="media-left media-icon"><span
                                    class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x text-danger"></i><i
                                    class="fa fa-hdd-o fa-stack-1x fa-inverse"></i></span></span>
                                <div class="media-body"><span class="block">你的密码是初始密码，请速修改</span><span
                                        class="text-muted block">1天前</span></div>
                            </a></li>
                            <li><a class="media" href="javascript:;"><span class="media-left media-icon"><span
                                    class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x text-success"></i><i
                                    class="fa fa-money fa-stack-1x fa-inverse"></i></span></span>
                                <div class="media-body"><span class="block">有合约即将到期，请联系客户续约</span><span
                                        class="text-muted block">5天前</span></div>
                            </a></li>
                            <li class="not-footer"><a href="#">查看所有提醒</a></li>
                        </ul>
                    </li>
                    <!-- User Menu-->
                    <li class="dropdown">
                        <a class="dropdown-toggle" href="/html/index.html" data-toggle="dropdown" role="button"
                           aria-haspopup="true" aria-expanded="false">
                            <i class="fa fa-user fa-lg"></i>
                        </a>
                        <ul class="dropdown-menu settings-menu">
                            <li><a href="#"><i
                                    class="fa fa-cog fa-lg"></i> 设置</a></li>
                            <li><a href="#"><i
                                    class="fa fa-user fa-lg"></i>配置</a></li>
                            <li><a href="/html/index.html"><i
                                    class="fa fa-sign-out fa-lg"></i>退出</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </nav>
    </header>
    <!-- Side-Nav-->
    <aside class="main-sidebar hidden-print">
        <div class="slimScrollDiv" style="position: relative; overflow: hidden; width: auto; height: 1284px;">
            <section class="sidebar" style="overflow: hidden; width: auto; height: 1284px;">
                <div class="user-panel">
                    <div class="pull-left image"><img class="img-circle" src="images/48.jpg" alt="User Image"></div>
                    <div class="pull-left info">
                        <p id="userName"></p>
                        <p class="designation">超级管理员</p>
                    </div>
                </div>
                <!-- Sidebar Menu-->
                <ul class="sidebar-menu">
                    <li class="active">
                        <a href="#" onclick="jump(1)"><i class="fa fa-dashboard"></i><span>用户管理</span></a>
                    </li>
                    <li class="active">
                        <a href="#" onclick="jump(5)"><i class="fa fa-dashboard"></i><span>合约管理</span></a>
                    </li>
                    <li class="active">
                        <a href="#" onclick="jump(10)"><i class="fa fa-dashboard"></i><span>工单管理</span></a>
                    </li>
                    <li class="active">
                        <a href="#" onclick="jump(6)"><i class="fa fa-dashboard"></i><span>参数设置</span></a>
                    </li>
                    <li class="active">
                        <a href="#" onclick="jump(7)"><i class="fa fa-dashboard"></i><span>公告管理</span></a>
                    </li>
                    <li class="active">
                        <a href="#" onclick="jump(8)"><i class="fa fa-dashboard"></i><span>常见问题管理</span></a>
                    </li>
                    <li class="active">
                        <a href="#" onclick="jump(9)"><i class="fa fa-dashboard"></i><span>留言管理</span></a>
                    </li>
                </ul>
            </section>
            <div class="slimScrollBar"
                 style="background: rgba(0, 0, 0, 0.8); width: 3px; position: absolute; top: 0px; opacity: 0.4; display: none; border-radius: 7px; z-index: 99; right: 1px; height: 1284px;"></div>
            <div class="slimScrollRail"
                 style="width: 3px; height: 100%; position: absolute; top: 0px; display: none; border-radius: 7px; background: rgb(51, 51, 51); opacity: 0.2; z-index: 90; right: 1px;"></div>
        </div>
    </aside>

    <div class="content-wrapper" id="param_set_page">
        <div class="row" style="margin:-20px -35px;" >
            <div class="col-md-12">
                <div class="card">

                    <div class="panel panel-default" style="margin:-10px -10px;">
                        <div class="panel-body">
                            <ul class="nav nav-tabs">
                                <li class=""><a onclick="paramSet(1)" href="#global_pass" data-toggle="tab" aria-expanded="false"><b>全局密码</b></a>
                                </li>
                                <li class=""><a onclick="paramSet(2)" id="a_top_miners" href="#top_miners" data-toggle="tab" aria-expanded="false"><b>矿池监控</b></a>
                                </li>
                                <li class=""><a onclick="paramSet(3)" id="a_house" href="#house" data-toggle="tab" aria-expanded="false"><b>机房设置</b></a>
                                </li>
                            </ul>

                            <div class="tab-content">
                                <div class="tab-pane fade active in" id="global_pass">
                                    <div class="panel-body" style="margin-top:5px;width:20%;">
                                        <div class="card-body">
                                            <form class="form-horizontal">
                                                <div class="form-group">
                                                    <label class="control-label col-md-3">密码</label>
                                                    <div class="col-md-8">
                                                        <input class="form-control" type="password" placeholder="新全局密码" style="width:300px;">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-md-3">管理员密码</label>
                                                    <div class="col-md-8">
                                                        <input class="form-control col-md-8" type="password" placeholder="当前账号登陆密码" style="width:300px;">
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                        <div class="card-footer">
                                            <div class="row">
                                                <div class="col-md-8 col-md-offset-3">
                                                    <button class="btn btn-primary icon-btn" type="button"><i class="fa fa-fw fa-lg fa-check-circle"></i>确定</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="top_miners">
                                    <div class="panel-body" style="margin-top:5px;width:20%;">
                                        <div class="card-body">

                                            <form class="form-horizontal" id="topset">

                                            </form>
                                        </div>
                                        <div class="card-footer">
                                            <div class="row">
                                                <div class="col-md-8 col-md-offset-3">
                                                    <button class="btn btn-primary icon-btn" onclick="updateColor()" type="button"><i class="fa fa-fw fa-lg fa-check-circle"></i>确定</button>
                                                    <button class="btn btn-primary icon-btn" onclick="colorAdd()" type="button"><i class="fa fa-fw fa-lg fa-check-circle"></i>添加</button>

                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="house">
                                    <div class="panel-body">
                                        <div class="card-body" id="set_house">
                                            <div class="house">
                                                <div class="circle">
                                                    <div class="onlinepercent" id="on_line_percent">58%</div>
                                                    <div class="onlinecount" id="on_line_count">15426</div>
                                                    <div hidden style="background-color: red;" class="onlinepercent" id="off_line_percent">58%</div>
                                                    <div hidden style="background-color: red;" class="onlinecount" id="off_line_count">15426</div>
                                                </div>
                                                <div class="houseName" id="house_name">东京</div>
                                            </div>
                                        </div>

                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>
</div>

<!-- Javascripts-->
<script src="js/jquery-2.1.4.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/pace.min.js"></script>
<script src="js/main.js"></script>
<script src="js/prototype.js"></script>
<script src="js/webcommon.js"></script>
<script src="js/colpick.js"></script>

<script type="text/javascript">

    function getParam(paramName) {
        paramValue = "", isFound = !1;
        if (this.location.search.indexOf("?") == 0 && this.location.search.indexOf("=") > 1) {
            arrSource = unescape(this.location.search).substring(1, this.location.search.length).split("&"), i = 0;
            while (i < arrSource.length && !isFound) arrSource[i].indexOf("=") > 0 && arrSource[i].split("=")[0].toLowerCase() == paramName.toLowerCase() && (paramValue = arrSource[i].split("=")[1], isFound = !0), i++
        }
        return paramValue == "" && (paramValue = null), paramValue
    }

    function colorSet() {
        var token = getParam("Authorization");

        $.getJSON("/ams/set/top/list?Authorization="+token, function(json) {
            if(json.err_code == 0) {
                var topHtml = "";
                for(var i = 0 ; i < json.data.top.length ; i++ ){
                    if(json.data.top[i].name == "0x84A0d77c693aD"){
                        json.data.top[i].name = "cc";
                    }else if(json.data.top[i].name == "0x00192Fb10dF37"){
                        json.data.top[i].name = "2miner";
                    }else if(json.data.top[i].name == "0x35F61DFB08ada"){
                        json.data.top[i].name = "hpool";
                    }

                    topHtml += "<div class='form-group'>";
                    topHtml += "<label class='control-label col-md-3'>" + json.data.top[i].name + "</label>";
                    topHtml += "<div class='col-md-8'>";
                    topHtml += "<input class='form-control col-md-8 btnColor' type='text' placeholder='点击选择颜色值' style='width:300px;background-color:" + json.data.top[i].color + "' value='" + json.data.top[i].color + "'>";
                    topHtml += "</div></div>";
                }
                $("#topset").html(topHtml);

                $('.btnColor').colpick({

                    colorScheme:'dark',

                    layout:'rgbhex',

                    color:'ff8800',

                    onSubmit:function(hsb,hex,rgb,el) {
                        $(el).css('background-color', '#'+hex);
                        $(el).val('#' + hex);
                        $(el).colpickHide();

                    }

                })

            }else{
                toastr.warning("获取top设置信息失败");
            }
        });
    }

    function houseSet() {
        var token = getParam("Authorization");

        $.getJSON("/ams/set/house/list?Authorization="+token, function(json) {
            if(json.err_code == 0) {
                var html = "";
                for(var i = 0 ; i < json.data.length ; i++){
                    html += '<div class="house" id="house_' + json.data[i].id + '">';
                    html += '<div class="circle" style="background-color: #458b00;" onclick="houseTurn(this)">';
                    html += '<div class="onlinepercent">' + (json.data[i].on_count/(json.data[i].on_count+json.data[i].off_count) * 100).toFixed(2) + '%</div>';
                    html += '<div class="onlinecount">' + json.data[i].on_count + '</div>';
                    html += '<div hidden class="onlinepercent" id="off_line_percent">' + (json.data[i].off_count/(json.data[i].on_count+json.data[i].off_count) * 100).toFixed(2) + '%</div>';
                    html += '<div hidden class="onlinecount" id="off_line_count">' + json.data[i].off_count + '</div>';
                    html += '</div>';
                    html += '<div class="houseName" id="house_name">' + json.data[i].name + '</div>';
                    html += '<div class="switch" id="switch_' + json.data[i].id + '">';
                    var onColor = "green";
                    var offColor = "white";
                    var flag = "on";
                    if(json.data[i].state == false){
                        onColor = "white";
                        offColor = "green";
                        flag = "off";
                    }
                    html += '<a style="background-color:' + onColor + ';" href="#" class="on"  id="switch_on_' + json.data[i].id + '" onclick="houseswitch(1,' + json.data[i].id + ')">on</a>';
                    html += '<a style="background-color:' + offColor + ';" href="#" class="off" id="switch_off_' + json.data[i].id + '" onclick="houseswitch(0,' + json.data[i].id + ')">off</a>';
                    html += '<input type="hidden" id="hid_house_' + json.data[i].id + '" value="' + flag + '" />';
                    html += '</div>';
                    html += '</div>';
                }
                $("#set_house").html(html);
            }else{
                toastr.warning("获取top设置信息失败");
            }
        });
    }

    function houseswitch(on,house_id) {
        var token = getParam("Authorization");
        var flag = $("#hid_house_" + house_id).val();
        if(on == 1){
            if(flag == "on"){
                alert("当前已是开机状态");
                return
            }
            $("#switch_on_" + house_id).css("background-color","green");
            $("#switch_off_" + house_id).css("background-color","white");
            $("#hid_house_" + house_id).val("on");
        }else if(on == 0){
            if(flag == "off"){
                alert("当前已是关机状态");
                return
            }
            $("#switch_on_" + house_id).css("background-color","white");
            $("#switch_off_" + house_id).css("background-color","green");
            $("#hid_house_" + house_id).val("off");
        }

        $.getJSON("/ams/set/house/state?Authorization="+token+"&house_id="+house_id+"&state="+on, function(json) {
            if(json.err_code == 0) {
                alert("状态设置成功");
                $.getJSON("/ams/set/house/info?Authorization="+token+"&house_id="+house_id, function(json) {
                    if(json.err_code == 0) {

                        var html = "";
                        html += '<div class="circle" style="background-color: #458b00;" onclick="houseTurn(this)">';
                        html += '<div class="onlinepercent">' + (json.house.on_count/(json.house.on_count+json.house.off_count) * 100).toFixed(2) + '%</div>';
                        html += '<div class="onlinecount">' + json.house.on_count + '</div>';
                        html += '<div hidden class="onlinepercent" id="off_line_percent">' + (json.house.off_count/(json.house.on_count+json.house.off_count) * 100).toFixed(2) + '%</div>';
                        html += '<div hidden class="onlinecount" id="off_line_count">' + json.house.off_count + '</div>';
                        html += '</div>';
                        html += '<div class="houseName" id="house_name">' + json.house.name + '</div>';
                        html += '<div class="switch" id="switch_' + json.house.id + '">';
                        var onColor = "green";
                        var offColor = "white";
                        var flag = "on";
                        if(json.house.state == false){
                            onColor = "white";
                            offColor = "green";
                            flag = "off";
                        }
                        html += '<a style="background-color:' + onColor + ';" href="#" class="on"  id="switch_on_' + json.house.id + '" onclick="houseswitch(1,' + json.house.id + ')">on</a>';
                        html += '<a style="background-color:' + offColor + ';" href="#" class="off" id="switch_off_' + json.house.id + '" onclick="houseswitch(0,' + json.house.id + ')">off</a>';
                        html += '<input type="hidden" id="hid_house_' + json.house.id + '" value="' + flag + '" />';
                        html += '</div>';
                        $("#house_"+house_id).html(html);
                    }
                });
            }else{
                alert("设置机房状态失败");
            }
        });

    }
    function paramSet(obj) {
        if(obj == 1){
            $("#topset").html("");
        }else if(obj == 2){
            colorSet();
        }else if(obj == 3){
            houseSet();
        }
    }

    function houseTurn(obj) {
        var s = $(obj).children();
        for(var i = 0 ; i < s.length ; i++){
            if(s.eq(i).is(":hidden")){
                s.eq(i).show();
            }else{
                s.eq(i).hide();
            }
        }

        var color = rgb2hex($(obj).css("background-color"))
        if(color == "#ff4040"){
            $(obj).css("background-color","#458b00");
        }else{
            $(obj).css("background-color","#ff4040");
        }
    }

    function zero_fill_hex(num, digits) {
        var s = num.toString(16);
        while (s.length < digits)
            s = "0" + s;
        return s;
    }

    function rgb2hex(rgb) {

        if (rgb.charAt(0) == '#')
            return rgb;

        var ds = rgb.split(/\D+/);
        var decimal = Number(ds[1]) * 65536 + Number(ds[2]) * 256 + Number(ds[3]);
        return "#" + zero_fill_hex(decimal, 6);
    }

    function jump(obj,id){
        var token = getParam("Authorization");

        if(obj == 1){
            location.href = "http://" + window.location.host + "/html/user1.html?" + "Authorization=" + token;
        }else if(obj == 2){
            location.href = "http://" + window.location.host + "/html/userwallet.html?" + "Authorization=" + token + "&user_id="+id;
        }else if(obj == 3){
            location.href = "http://" + window.location.host + "/html/sonuser.html?" + "Authorization=" + token + "&parent_id="+id;
        }else if(obj == 4){
            location.href = "http://" + window.location.host + "/html/usermachine.html?" + "Authorization=" + token + "&user_id="+id;
        }else if(obj == 5){
            location.href = "http://" + window.location.host + "/html/contract.html?" + "Authorization=" + token;
        }else if(obj == 6){
            location.href = "http://" + window.location.host + "/html/paramset.html?" + "Authorization=" + token;
        }else if(obj == 7){
            location.href = "http://" + window.location.host + "/html/notice.html?" + "Authorization=" + token;
        }else if(obj == 8){
            location.href = "http://" + window.location.host + "/html/question.html?" + "Authorization=" + token;
        }else if(obj == 9){
            location.href = "http://" + window.location.host + "/html/msgboard.html?" + "Authorization=" + token;
        }else if(obj == 10){
            location.href = "http://" + window.location.host + "/html/worklist.html?" + "Authorization=" + token;
        }
    }

    function PageInit() {
        var userName = $.cookie("admin_name");
        $("#userName").text(userName);
    }

    PageInit();

</script>

</body>
</html>